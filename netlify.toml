[build]
  # Command to build the site
  command = "npm install && npm run build && node scripts/compress_brotli.js"
  # Directory to publish
  publish = "public"

[build.environment]
  # Specify Node.js version
  NODE_VERSION = "20"
  # Specify Hugo version (optional, but good practice)
  # Check your local 'hugo version' or Netlify's default if unsure
  HUGO_VERSION = "0.133.0"
  # Maximize Hugo parallelism for Netlify's CPU allocation
  HUGO_NUMWORKERMULTIPLIER = "3"
  # Disable expensive git operations for faster builds
  HUGO_ENABLEGITINFO = "false"
  # Skip SASS processing in Hugo (handle separately if needed)
  HUGO_SKIP_SASS = "true"

[context.production.environment]
  HUGO_ENV = "production"

[context.deploy-preview.environment]
  HUGO_ENV = "development"

[context.branch-deploy.environment]
  HUGO_ENV = "development" 

# Force all HTTP traffic to HTTPS and add security headers
[[redirects]]
  from = "http://*"
  to   = "https://:splat"
  status = 301
  force = true

[[headers]]
  for = "/*"
  [headers.values]
    Strict-Transport-Security = "max-age=63072000; includeSubDomains; preload"
    Content-Security-Policy   = "default-src 'self'; img-src 'self' data: https:; script-src 'self' 'unsafe-inline' https://plausible.io; style-src 'self' 'unsafe-inline' https:; font-src 'self' https:; connect-src 'self' https://plausible.io; object-src 'none'; base-uri 'self';"
    X-Frame-Options           = "DENY"
    X-Content-Type-Options    = "nosniff"
    Referrer-Policy           = "strict-origin-when-cross-origin"
    Permissions-Policy        = "geolocation=(), camera=()" 